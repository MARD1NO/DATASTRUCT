# 哈希算法定义

定义：将任意长度的二进制值串映射为固定长度的二进制值串

这个**映射规则被称为哈希算法**

而通过原始数据映射后得到的**二进制串被称为哈希值**



## 哈希算法要求

1. 从哈希值**不能反向推导**出原始数据
2. 对输入数据非常**敏感**，即使数据修改了一个bit最后得到的哈希值也大不相同
3. 散列冲突**概率要很小**
4. 哈希算法的执行效率要**高效**



# 哈希算法应用

## 安全加密

常用于加密的哈希算法有 MD5 SHA DES AES

对于安全加密的算法，它有两点很重要，即不能**反向推导，哈希冲突概率很小**

MD5加密后产生的哈希值是一个128位二进制串，一般来说，**哈希值越长的哈希算法，散列冲突概率越低**

相对来说，MD5有2^128个不同哈希值，因此对应哈希冲突概率已经是很低的了

**当然没有绝对安全可靠的算法，越复杂的密码所需破解的时间也越长，需要在实际开发中进行权衡**



## 唯一标识

比如我们需要在图库里寻找图片是否存在，如果单用图片的信息搜索，那会十分低效。

因此我们给每个图片构造一个唯一标识，我们可以给图片的二进制码开头取100个字节，中间取100个字节，最后再取100个字节，一共300个字节，扔进MD5，得到的哈希值作为该图片的唯一标识



## 数据校验

基于P2P协议下载的文件通常被分为多个文件块，为了保证我们下载到的文件完整没有被恶意篡改

我们可以对每个文件块用哈希算法得到一个哈希值，下载完成后再依次比对



因为我们哈希算法对输入数据敏感，当文件块缺失数据，哈希值会有很大变化



## 散列函数

前面讲到的散列表用到了哈希算法，但是散列函数重点在于避免哈希冲突，对于安全性和是否能反向推导就不那么关心

![image-20200304123644511](F:\GeekTime_Algorithm\pic\image-20200304123644511.png)



## 负载均衡

实现一个会话粘滞的负载均衡算法，就是在同一个客户端，在**一次会话**中所有的请求都路由到**同一个服务器上**

**我们可以通过哈希算法，对客户端 IP 地址或者会话 ID 计算哈希值，将取得的哈希值与服务器列表的大小进行取模运算，最终得到的值就是应该被路由到的服务器编号**



## 数据分片

当有1T的日志文件，需要搜索关键词

2个难点

1. 数据量太大，无法放在一个机器的内存当中
2. 只用一个机器来处理如此多的数据，那么效率会很慢



基于这两个难点，我们使用多台机器并行处理

比如n台机器，我们对日志文件中的每条记录都做个哈希运算，再对n取模，取模后的值就是我们需要放的机器编号



## 分布式存储

互联网实际场景面向大量用户，当我们需要添加机器来拓展存储空间的时候，那么哈希值取模的值会变化，因此会导致数据重新搬移，**先前缓存的数据位置发生了变化**，因此**缓存也就失效**

我们需要一个方法来保证加入一个新机器之后，不需要做大量的数据搬移

这里用到的就是 **一致性哈希算法**



假设我们有 k 个机器，数据的哈希值的范围是**[0, MAX]**。我们将整个范围划分成 **m 个小区间（m 远大于 k）**，**每个机器负责 m/k 个小区间**。当有新机器加入的时候，我们就将**某几个小区间**的数据，从原来的机器中**搬移到新的机器中**。这样，既不用全部重新哈希、搬移数据，也保持了各个机器上数据数量的均衡。



 https://www.jianshu.com/p/570dc8913c20 

简单来说就相当于把一个区间设计为一个环形，当有新节点加入的时候，将原先的数据放到该节点所负责的区间内